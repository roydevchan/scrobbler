/*!
 * CanJS - 2.1.2
 * http://canjs.us/
 * Copyright (c) 2014 Bitovi
 * Sun, 29 Jun 2014 19:58:11 GMT
 * Licensed MIT
 * Includes: can/construct/construct.js,can/map/map.js,can/list/list.js,can/compute/compute.js,can/model/model.js
 * Download from: http://bitbuilder.herokuapp.com/can.custom.js?configuration=jquery&minify=true&plugins=can%2Fconstruct%2Fconstruct.js&plugins=can%2Fmap%2Fmap.js&plugins=can%2Flist%2Flist.js&plugins=can%2Fcompute%2Fcompute.js&plugins=can%2Fmodel%2Fmodel.js
 */
(function(t){var e=function(){var t=window.can||{};("undefined"==typeof GLOBALCAN||GLOBALCAN!==!1)&&(window.can=t),t.k=function(){},t.isDeferred=function(t){return t&&"function"==typeof t.then&&"function"==typeof t.pipe};var e=0;return t.cid=function(t,n){return t._cid||(e++,t._cid=(n||"")+e),t._cid},t.VERSION="@EDGE",t.simpleExtend=function(t,e){for(var n in e)t[n]=e[n];return t},t.frag=function(e){var n;return e&&"string"!=typeof e?11===e.nodeType?e:"number"==typeof e.nodeType?(n=document.createDocumentFragment(),n.appendChild(e),n):"number"==typeof e.length?(n=document.createDocumentFragment(),t.each(e,function(e){n.appendChild(t.frag(e))}),n):(n=t.buildFragment(""+e,document.body),n.childNodes.length||n.appendChild(document.createTextNode("")),n):(n=t.buildFragment(null==e?"":""+e,document.body),n.childNodes.length||n.appendChild(document.createTextNode("")),n)},t.__reading=function(){},t}(),n=function(e){var n=window.setImmediate||function(t){return setTimeout(t,0)},r={MutationObserver:window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,map:{"class":"className",value:"value",innerText:"innerText",textContent:"textContent",checked:!0,disabled:!0,readonly:!0,required:!0,src:function(t,e){return null==e||""===e?(t.removeAttribute("src"),null):(t.setAttribute("src",e),e)},style:function(t,e){return t.style.cssText=e||""}},defaultValue:["input","textarea"],set:function(t,n,i){var a;r.MutationObserver||(a=r.get(t,n));var s,o=(""+t.nodeName).toLowerCase(),u=r.map[n];"function"==typeof u?s=u(t,i):u===!0?(s=t[n]=!0,"checked"===n&&"radio"===t.type&&e.inArray(o,r.defaultValue)>=0&&(t.defaultChecked=!0)):u?(s=t[u]=i,"value"===u&&e.inArray(o,r.defaultValue)>=0&&(t.defaultValue=i)):(t.setAttribute(n,i),s=i),r.MutationObserver||s===a||r.trigger(t,n,a)},trigger:function(r,i,a){return e.data(e.$(r),"canHasAttributesBindings")?n(function(){e.trigger(r,{type:"attributes",attributeName:i,target:r,oldValue:a,bubbles:!1},[])}):t},get:function(t,e){var n=r.map[e];return"string"==typeof n&&t[n]?t[n]:t.getAttribute(e)},remove:function(e,n){var i;r.MutationObserver||(i=r.get(e,n));var a=r.map[n];"function"==typeof a&&a(e,t),a===!0?e[n]=!1:"string"==typeof a?e[a]="":e.removeAttribute(n),r.MutationObserver||null==i||r.trigger(e,n,i)},has:function(){var t=document.createElement("div");return t.hasAttribute?function(t,e){return t.hasAttribute(e)}:function(t,e){return null!==t.getAttribute(e)}}()};return r}(e),r=function(t){return t.addEvent=function(t,e){var n=this.__bindEvents||(this.__bindEvents={}),r=n[t]||(n[t]=[]);return r.push({handler:e,name:t}),this},t.listenTo=function(e,n,r){var i=this.__listenToEvents;i||(i=this.__listenToEvents={});var a=t.cid(e),s=i[a];s||(s=i[a]={obj:e,events:{}});var o=s.events[n];o||(o=s.events[n]=[]),o.push(r),t.bind.call(e,n,r)},t.stopListening=function(e,n,r){var i=this.__listenToEvents,a=i,s=0;if(!i)return this;if(e){var o=t.cid(e);if((a={})[o]=i[o],!i[o])return this}for(var u in a){var c,l=a[u];e=i[u].obj,n?(c={})[n]=l.events[n]:c=l.events;for(var h in c){var d=c[h]||[];for(s=0;d.length>s;)r&&r===d[s]||!r?(t.unbind.call(e,h,d[s]),d.splice(s,1)):s++;d.length||delete l.events[h]}t.isEmptyObject(l.events)&&delete i[u]}return this},t.removeEvent=function(t,e,n){if(!this.__bindEvents)return this;for(var r,i=this.__bindEvents[t]||[],a=0,s="function"==typeof e;i.length>a;)r=i[a],(n?n(r,t,e):s&&r.handler===e||!s&&(r.cid===e||!e))?i.splice(a,1):a++;return this},t.dispatch=function(t,e){var n=this.__bindEvents;if(n){"string"==typeof t&&(t={type:t});var r=t.type,i=(n[r]||[]).slice(0),a=[t];e&&a.push.apply(a,e);for(var s=0,o=i.length;o>s;s++)i[s].handler.apply(this,a);return t}},t.one=function(e,n){var r=function(){return t.unbind.call(this,e,r),n.apply(this,arguments)};return t.bind.call(this,e,r),this},t.event={on:function(){return 0===arguments.length&&t.Control&&this instanceof t.Control?t.Control.prototype.on.call(this):t.addEvent.apply(this,arguments)},off:function(){return 0===arguments.length&&t.Control&&this instanceof t.Control?t.Control.prototype.off.call(this):t.removeEvent.apply(this,arguments)},bind:t.addEvent,unbind:t.removeEvent,delegate:function(e,n,r){return t.addEvent.call(this,n,r)},undelegate:function(e,n,r){return t.removeEvent.call(this,n,r)},trigger:t.dispatch,one:t.one,addEvent:t.addEvent,removeEvent:t.removeEvent,listenTo:t.listenTo,stopListening:t.stopListening,dispatch:t.dispatch},t.event}(e),i=function(t){var e=function(t){var e=t.length;return"function"!=typeof arr&&(0===e||"number"==typeof e&&e>0&&e-1 in t)};return t.each=function(n,r,i){var a,s,o,u=0;if(n)if(e(n))if(t.List&&n instanceof t.List)for(s=n.attr("length");s>u&&(o=n.attr(u),r.call(i||o,o,u,n)!==!1);u++);else for(s=n.length;s>u&&(o=n[u],r.call(i||o,o,u,n)!==!1);u++);else if("object"==typeof n)if(t.Map&&n instanceof t.Map||n===t.route){var c=t.Map.keys(n);for(u=0,s=c.length;s>u&&(a=c[u],o=n.attr(a),r.call(i||o,o,a,n)!==!1);u++);}else for(a in n)if(n.hasOwnProperty(a)&&r.call(i||n[a],n[a],a,n)===!1)break;return n},t}(e),a=function(e){e.inserted=function(n){n=e.makeArray(n);for(var r,i,a=!1,s=e.$(document.contains?document:document.body),o=0;(i=n[o])!==t;o++){if(!a){if(!i.getElementsByTagName)continue;if(!e.has(s,i).length)return;a=!0}if(a&&i.getElementsByTagName){r=e.makeArray(i.getElementsByTagName("*")),e.trigger(i,"inserted",[],!1);for(var u,c=0;(u=r[c])!==t;c++)e.trigger(u,"inserted",[],!1)}}},e.appendChild=function(t,n){var r;r=11===n.nodeType?e.makeArray(n.childNodes):[n],t.appendChild(n),e.inserted(r)},e.insertBefore=function(t,n,r){var i;i=11===n.nodeType?e.makeArray(n.childNodes):[n],t.insertBefore(n,r),e.inserted(i)}}(e),s=function(t,e,n){var r=function(t){return t.nodeName&&(1===t.nodeType||9===t.nodeType)||t==window};t.extend(e,t,{trigger:function(n,i,a,s){r(n)?t.event.trigger(i,a,n,!s):n.trigger?n.trigger(i,a):("string"==typeof i&&(i={type:i}),i.target=i.target||n,a&&(a.length&&"string"==typeof a?a=[a]:a.length||(a=[a])),a||(a=[]),e.dispatch.call(n,i,a))},event:e.event,addEvent:e.addEvent,removeEvent:e.removeEvent,buildFragment:function(e,n){var r;return e=[e],n=n||document,n=!n.nodeType&&n[0]||n,n=n.ownerDocument||n,r=t.buildFragment(e,n),r.cacheable?t.clone(r.fragment):r.fragment||r},$:t,each:e.each,bind:function(n,i){return this.bind&&this.bind!==e.bind?this.bind(n,i):r(this)?t.event.add(this,n,i):e.addEvent.call(this,n,i),this},unbind:function(n,i){return this.unbind&&this.unbind!==e.unbind?this.unbind(n,i):r(this)?t.event.remove(this,n,i):e.removeEvent.call(this,n,i),this},delegate:function(n,i,a){return this.delegate?this.delegate(n,i,a):r(this)?t(this).delegate(n,i,a):e.bind.call(this,i,a),this},undelegate:function(n,i,a){return this.undelegate?this.undelegate(n,i,a):r(this)?t(this).undelegate(n,i,a):e.unbind.call(this,i,a),this},proxy:function(t,e){return function(){return t.apply(e,arguments)}},attr:n}),e.on=e.bind,e.off=e.unbind,t.each(["append","filter","addClass","remove","data","get","has"],function(t,n){e[n]=function(t){return t[n].apply(t,e.makeArray(arguments).slice(1))}});var i=t.cleanData;t.cleanData=function(n){t.each(n,function(t,n){n&&e.trigger(n,"removed",[],!1)}),i(n)};var a,s=t.fn.domManip;if(t.fn.domManip=function(){for(var t=1;arguments.length>t;t++)if("function"==typeof arguments[t]){a=t;break}return s.apply(this,arguments)},t(document.createElement("div")).append(document.createElement("div")),t.fn.domManip=2===a?function(t,n,r){return s.call(this,t,n,function(t){var n;11===t.nodeType&&(n=e.makeArray(t.childNodes));var i=r.apply(this,arguments);return e.inserted(n?n:[t]),i})}:function(t,n){return s.call(this,t,function(t){var r;11===t.nodeType&&(r=e.makeArray(t.childNodes));var i=n.apply(this,arguments);return e.inserted(r?r:[t]),i})},e.attr.MutationObserver)t.event.special.attributes={setup:function(){var t=this,n=new e.attr.MutationObserver(function(n){n.forEach(function(n){var r=e.simpleExtend({},n);e.trigger(t,r,[])})});n.observe(this,{attributes:!0,attributeOldValue:!0}),e.data(e.$(this),"canAttributesObserver",n)},teardown:function(){e.data(e.$(this),"canAttributesObserver").disconnect(),t.removeData(this,"canAttributesObserver")}};else{var o=t.attr;t.attr=function(t,n){var r,i;arguments.length>=3&&(r=o.call(this,t,n));var a=o.apply(this,arguments);return arguments.length>=3&&(i=o.call(this,t,n)),i!==r&&e.attr.trigger(t,n,r),a};var u=t.removeAttr;t.removeAttr=function(t,n){var r=o.call(this,t,n),i=u.apply(this,arguments);return null!=r&&e.attr.trigger(t,n,r),i},t.event.special.attributes={setup:function(){e.data(e.$(this),"canHasAttributesBindings",!0)},teardown:function(){t.removeData(this,"canHasAttributesBindings")}}}return function(){var t="<-\n>",n=e.buildFragment(t,document);if(t!==n.childNodes[0].nodeValue){var r=e.buildFragment;e.buildFragment=function(t,e){var n=r(t,e);return 1===n.childNodes.length&&3===n.childNodes[0].nodeType&&(n.childNodes[0].nodeValue=t),n}}}(),t.event.special.inserted={},t.event.special.removed={},e}(jQuery,e,n,r,i,a),o=function(e){var n=/_|-/,r=/\=\=/,i=/([A-Z]+)([A-Z][a-z])/g,a=/([a-z\d])([A-Z])/g,s=/([a-z\d])([A-Z])/g,o=/\{([^\}]+)\}/g,u=/"/g,c=/'/g,l=/-+(.)?/g,h=/[a-z][A-Z]/g,d=function(e,n,r){var i=e[n];return i===t&&r===!0&&(i=e[n]={}),i},p=function(t){return/^f|^o/.test(typeof t)},f=function(e){var n=null===e||e===t||isNaN(e)&&"NaN"==""+e;return""+(n?"":e)};return e.extend(e,{esc:function(t){return f(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(u,"&#34;").replace(c,"&#39;")},getObject:function(n,r,i){var a,s,o,u,c=n?n.split("."):[],l=c.length,h=0;if(r=e.isArray(r)?r:[r||window],u=r.length,!l)return r[0];for(h;u>h;h++){for(a=r[h],o=t,s=0;l>s&&p(a);s++)o=a,a=d(o,c[s]);if(o!==t&&a!==t)break}if(i===!1&&a!==t&&delete o[c[s-1]],i===!0&&a===t)for(a=r[0],s=0;l>s&&p(a);s++)a=d(a,c[s],!0);return a},capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},camelize:function(t){return f(t).replace(l,function(t,e){return e?e.toUpperCase():""})},hyphenate:function(t){return f(t).replace(h,function(t){return t.charAt(0)+"-"+t.charAt(1).toLowerCase()})},underscore:function(t){return t.replace(r,"/").replace(i,"$1_$2").replace(a,"$1_$2").replace(s,"_").toLowerCase()},sub:function(n,r,i){var a=[];return n=n||"",a.push(n.replace(o,function(n,s){var o=e.getObject(s,r,i===!0?!1:t);return o===t||null===o?(a=null,""):p(o)&&a?(a.push(o),""):""+o})),null===a?a:1>=a.length?a[0]:a},replacer:o,undHash:n}),e}(s),u=function(e){var n=0;return e.Construct=function(){return arguments.length?e.Construct.extend.apply(e.Construct,arguments):t},e.extend(e.Construct,{constructorExtends:!0,newInstance:function(){var t,e=this.instance();return e.setup&&(t=e.setup.apply(e,arguments)),e.init&&e.init.apply(e,t||arguments),e},_inherit:function(t,n,r){e.extend(r||t,t||{})},_overwrite:function(t,e,n,r){t[n]=r},setup:function(t){this.defaults=e.extend(!0,{},t.defaults,this.defaults)},instance:function(){n=1;var t=new this;return n=0,t},extend:function(r,i,a){function s(){return n?t:this.constructor!==s&&arguments.length&&s.constructorExtends?s.extend.apply(s,arguments):s.newInstance.apply(s,arguments)}"string"!=typeof r&&(a=i,i=r,r=null),a||(a=i,i=null),a=a||{};var o,u,c,l,h,d,p,f,g=this,m=this.prototype;f=this.instance(),e.Construct._inherit(a,m,f);for(h in g)g.hasOwnProperty(h)&&(s[h]=g[h]);e.Construct._inherit(i,g,s),r&&(o=r.split("."),d=o.pop(),u=e.getObject(o.join("."),window,!0),p=u,c=e.underscore(r.replace(/\./g,"_")),l=e.underscore(d),u[d]=s),e.extend(s,{constructor:s,prototype:f,namespace:p,_shortName:l,fullName:r,_fullName:c}),d!==t&&(s.shortName=d),s.prototype.constructor=s;var v=[g].concat(e.makeArray(arguments)),_=s.setup.apply(s,v);return s.init&&s.init.apply(s,_||v),s}}),e.Construct.prototype.setup=function(){},e.Construct.prototype.init=function(){},e.Construct}(o),c=function(t){return t.bindAndSetup=function(){return t.addEvent.apply(this,arguments),this._init||(this._bindings?this._bindings++:(this._bindings=1,this._bindsetup&&this._bindsetup())),this},t.unbindAndTeardown=function(){return t.removeEvent.apply(this,arguments),null===this._bindings?this._bindings=0:this._bindings--,!this._bindings&&this._bindteardown&&this._bindteardown(),this},t}(s),l=function(t){var e=t.bubble={event:function(t,e){return t.constructor._bubbleRule(e,t)},childrenOf:function(t,n){t._each(function(r,i){r&&r.bind&&e.toParent(r,t,i,n)})},teardownChildrenFrom:function(t,n){t._each(function(r){e.teardownFromParent(t,r,n)})},toParent:function(e,n,r,i){t.listenTo.call(n,e,i,function(){var i=t.makeArray(arguments),a=i.shift();i[0]=(t.List&&n instanceof t.List?n.indexOf(e):r)+(i[0]?"."+i[0]:""),a.triggeredNS=a.triggeredNS||{},a.triggeredNS[n._cid]||(a.triggeredNS[n._cid]=!0,t.trigger(n,a,i))})},teardownFromParent:function(e,n,r){n&&n.unbind&&t.stopListening.call(e,n,r)},isBubbling:function(t,e){return t._bubbleBindings&&t._bubbleBindings[e]},bind:function(t,n){if(!t._init){var r=e.event(t,n);r&&(t._bubbleBindings||(t._bubbleBindings={}),t._bubbleBindings[r]?t._bubbleBindings[r]++:(t._bubbleBindings[r]=1,e.childrenOf(t,r)))}},unbind:function(n,r){var i=e.event(n,r);i&&(n._bubbleBindings&&n._bubbleBindings[i]--,n._bubbleBindings&&!n._bubbleBindings[i]&&(delete n._bubbleBindings[i],e.teardownChildrenFrom(n,i),t.isEmptyObject(n._bubbleBindings)&&delete n._bubbleBindings))},add:function(n,r,i){if(r instanceof t.Map&&n._bubbleBindings)for(var a in n._bubbleBindings)n._bubbleBindings[a]&&(e.teardownFromParent(n,r,a),e.toParent(r,n,i,a))},removeMany:function(t,n){for(var r=0,i=n.length;i>r;r++)e.remove(t,n[r])},remove:function(n,r){if(r instanceof t.Map&&n._bubbleBindings)for(var i in n._bubbleBindings)n._bubbleBindings[i]&&e.teardownFromParent(n,r,i)},set:function(n,r,i,a){return t.Map.helpers.isObservable(i)&&e.add(n,i,r),t.Map.helpers.isObservable(a)&&e.remove(n,a),i}};return e}(s),h=function(t){var e=1,n=0,r=[],i=[];t.batch={start:function(t){n++,t&&i.push(t)},stop:function(a,s){if(a?n=0:n--,0===n){var o,u,c=r.slice(0),l=i.slice(0);for(r=[],i=[],e++,s&&t.batch.start(),o=0,u=c.length;u>o;o++)t.dispatch.apply(c[o][0],c[o][1]);for(o=0,u=l.length;l.length>o;o++)l[o]()}},trigger:function(i,a,s){if(!i._init){if(0===n)return t.dispatch.call(i,a,s);a="string"==typeof a?{type:a}:a,a.batchNum=e,r.push([i,[a,s]])}}}}(e),d=function(e,n,r){var i=null,a=function(){for(var t in i)i[t].added&&delete i[t].obj._cid;i=null},s=function(t){return i&&i[t._cid]&&i[t._cid].instance},o=null,u=e.Map=e.Construct.extend({setup:function(){if(e.Construct.setup.apply(this,arguments),e.Map){this.defaults||(this.defaults={}),this._computes=[];for(var t in this.prototype)"define"!==t&&"function"!=typeof this.prototype[t]?this.defaults[t]=this.prototype[t]:this.prototype[t].isComputed&&this._computes.push(t);this.helpers.define&&this.helpers.define(this)}!e.List||this.prototype instanceof e.List||(this.List=u.List.extend({Map:this},{}))},_bubble:r,_bubbleRule:function(t){return("change"===t||t.indexOf(".")>=0)&&"change"},_computes:[],bind:e.bindAndSetup,on:e.bindAndSetup,unbind:e.unbindAndTeardown,off:e.unbindAndTeardown,id:"id",helpers:{define:null,attrParts:function(t,e){return e?[t]:"object"==typeof t?t:(""+t).split(".")},addToMap:function(t,n){var r;i||(r=a,i={});var s=t._cid,o=e.cid(t);return i[o]||(i[o]={obj:t,instance:n,added:!s}),r},isObservable:function(t){return t instanceof e.Map||t&&t===e.route},canMakeObserve:function(t){return t&&!e.isDeferred(t)&&(e.isArray(t)||e.isPlainObject(t))},serialize:function(n,r,i){var a=e.cid(n),s=!1;return o||(s=!0,o={attr:{},serialize:{}}),o[r][a]=i,n.each(function(a,s){var c,l=u.helpers.isObservable(a),h=l&&o[r][e.cid(a)];c=h?h:"serialize"===r?u.helpers._serialize(n,s,a):u.helpers._getValue(n,s,a,r),c!==t&&(i[s]=c)}),e.__reading(n,"__keys"),s&&(o=null),i},_serialize:function(t,e,n){return u.helpers._getValue(t,e,n,"serialize")},_getValue:function(t,e,n,r){return u.helpers.isObservable(n)?n[r]():n}},keys:function(t){var n=[];e.__reading(t,"__keys");for(var r in t._data)n.push(r);return n}},{setup:function(t){this._data={},e.cid(this,".map"),this._init=1;var n=this._setupDefaults();this._setupComputes(n);var r=t&&e.Map.helpers.addToMap(t,this),i=e.extend(e.extend(!0,{},n),t);this.attr(i),r&&r(),this.bind("change",e.proxy(this._changes,this)),delete this._init},_setupComputes:function(){var t=this.constructor._computes;this._computedBindings={};for(var e,n=0,r=t.length;r>n;n++)e=t[n],this[e]=this[e].clone(this),this._computedBindings[e]={count:0}},_setupDefaults:function(){return this.constructor.defaults||{}},_bindsetup:function(){},_bindteardown:function(){},_changes:function(t,n,r,i,a){e.batch.trigger(this,{type:n,batchNum:t.batchNum,target:t.target},[i,a])},_triggerChange:function(t,n,i,a){r.isBubbling(this,"change")?e.batch.trigger(this,{type:"change",target:this},[t,n,i,a]):e.batch.trigger(this,t,[i,a]),("remove"===n||"add"===n)&&e.batch.trigger(this,{type:"__keys",target:this})},_each:function(t){var e=this.__get();for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)},attr:function(t,n){var r=typeof t;return"string"!==r&&"number"!==r?this._attrs(t,n):1===arguments.length?(e.__reading(this,t),this._get(t)):(this._set(t,n),this)},each:function(){return e.each.apply(t,[this].concat(e.makeArray(arguments)))},removeAttr:function(t){var n=e.List&&this instanceof e.List,r=e.Map.helpers.attrParts(t),i=r.shift(),a=n?this[i]:this._data[i];return r.length&&a?a.removeAttr(r):("string"==typeof t&&~t.indexOf(".")&&(i=t),this._remove(i,a),a)},_remove:function(e,n){e in this._data&&(delete this._data[e],e in this.constructor.prototype||delete this[e],this._triggerChange(e,"remove",t,n))},_get:function(e){e=""+e;var n=e.indexOf(".");if(n>=0){var r=this.__get(e);if(r!==t)return r;var i=e.substr(0,n),a=e.substr(n+1),s=this.__get(i);return s&&s._get?s._get(a):t}return this.__get(e)},__get:function(t){return t?this._computedBindings[t]?this[t]():this._data[t]:this._data},__type:function(t){if(!(t instanceof e.Map)&&e.Map.helpers.canMakeObserve(t)){var n=s(t);if(n)return n;if(e.isArray(t)){var r=e.List;return new r(t)}var i=this.constructor.Map||e.Map;return new i(t)}return t},_set:function(e,n,r){e=""+e;var i,a=e.indexOf(".");if(!r&&a>=0){var s=e.substr(0,a),o=e.substr(a+1);if(i=this._init?t:this.__get(s),!u.helpers.isObservable(i))throw"can.Map: Object does not exist";i._set(o,n)}else this.__convert&&(n=this.__convert(e,n)),i=this._init?t:this.__get(e),this.__set(e,this.__type(n,e),i)},__set:function(e,n,r){if(n!==r){var i=r!==t||this.__get().hasOwnProperty(e)?"set":"add";this.___set(e,this.constructor._bubble.set(this,e,n,r)),this._triggerChange(e,i,n,r),r&&this.constructor._bubble.teardownFromParent(this,r)}},___set:function(t,e){this._computedBindings[t]?this[t](e):this._data[t]=e,"function"==typeof this.constructor.prototype[t]||this._computedBindings[t]||(this[t]=e)},bind:function(t){var n=this._computedBindings&&this._computedBindings[t];if(n)if(n.count)n.count++;else{n.count=1;var r=this;n.handler=function(n,i,a){e.batch.trigger(r,{type:t,batchNum:n.batchNum,target:r},[i,a])},this[t].bind("change",n.handler)}return this.constructor._bubble.bind(this,t),e.bindAndSetup.apply(this,arguments)},unbind:function(t){var n=this._computedBindings&&this._computedBindings[t];return n&&(1===n.count?(n.count=0,this[t].unbind("change",n.handler),delete n.handler):n.count--),this.constructor._bubble.unbind(this,t),e.unbindAndTeardown.apply(this,arguments)},serialize:function(){return e.Map.helpers.serialize(this,"serialize",{})},_attrs:function(n,r){if(n===t)return u.helpers.serialize(this,"attr",{});n=e.simpleExtend({},n);var i,a,s=this;e.batch.start(),this.each(function(e,i){if("_cid"!==i){if(a=n[i],a===t)return r&&s.removeAttr(i),t;s.__convert&&(a=s.__convert(i,a)),u.helpers.isObservable(a)?s.__set(i,s.__type(a,i),e):u.helpers.isObservable(e)&&u.helpers.canMakeObserve(a)?e.attr(a,r):e!==a&&s.__set(i,s.__type(a,i),e),delete n[i]}});for(i in n)"_cid"!==i&&(a=n[i],this._set(i,a,!0));return e.batch.stop(),this},compute:function(n){if(e.isFunction(this.constructor.prototype[n]))return e.compute(this[n],this);var r=n.split("."),i=r.length-1,a={args:[]};return e.compute(function(n){return arguments.length?(e.compute.read(this,r.slice(0,i)).value.attr(r[i],n),t):e.compute.read(this,r,a).value},this)}});return u.prototype.on=u.prototype.bind,u.prototype.off=u.prototype.unbind,u}(s,c,l,u,h),p=function(e,n,r){var i=[].splice,a=function(){var t={0:"a",length:1};return i.call(t,0,1),!t[0]}(),s=n.extend({Map:n},{setup:function(t,n){this.length=0,e.cid(this,".map"),this._init=1,this._setupComputes(),t=t||[];var r;e.isDeferred(t)?this.replace(t):(r=t.length&&e.Map.helpers.addToMap(t,this),this.push.apply(this,e.makeArray(t||[]))),r&&r(),this.bind("change",e.proxy(this._changes,this)),e.simpleExtend(this,n),delete this._init},_triggerChange:function(t,r,i,a){n.prototype._triggerChange.apply(this,arguments);var s=+t;~t.indexOf(".")||isNaN(s)||("add"===r?(e.batch.trigger(this,r,[i,s]),e.batch.trigger(this,"length",[this.length])):"remove"===r?(e.batch.trigger(this,r,[a,s]),e.batch.trigger(this,"length",[this.length])):e.batch.trigger(this,r,[i,s]))},__get:function(t){return t?this[t]&&this[t].isComputed&&e.isFunction(this.constructor.prototype[t])?this[t]():this[t]:this},___set:function(t,e){this[t]=e,+t>=this.length&&(this.length=+t+1)},_remove:function(e,n){isNaN(+e)?(delete this[e],this._triggerChange(e,"remove",t,n)):this.splice(e,1)},_each:function(t){for(var e=this.__get(),n=0;e.length>n;n++)t(e[n],n)},serialize:function(){return n.helpers.serialize(this,"serialize",[])},splice:function(n,s){var o,u,c=e.makeArray(arguments),l=[];for(o=2;c.length>o;o++)c[o]=r.set(this,o,this.__type(c[o],o)),l.push(c[o]);s===t&&(s=c[1]=this.length-n);var h=i.apply(this,c),d=h;if(l.length&&h.length)for(u=0;h.length>u;u++)e.inArray(h[u],l)>=0&&d.splice(u,1);if(!a)for(o=this.length;h.length+this.length>o;o++)delete this[o];return e.batch.start(),s>0&&(this._triggerChange(""+n,"remove",t,h),r.removeMany(this,h)),c.length>2&&this._triggerChange(""+n,"add",c.slice(2),h),e.batch.stop(),h},_attrs:function(r,i){return r===t?n.helpers.serialize(this,"attr",[]):(r=e.makeArray(r),e.batch.start(),this._updateAttrs(r,i),e.batch.stop(),t)},_updateAttrs:function(t,e){for(var r=Math.min(t.length,this.length),i=0;r>i;i++){var a=this[i],s=t[i];n.helpers.isObservable(a)&&n.helpers.canMakeObserve(s)?a.attr(s,e):a!==s&&this._set(i,s)}t.length>this.length?this.push.apply(this,t.slice(this.length)):t.length<this.length&&e&&this.splice(t.length)}}),o=function(t){return t[0]&&e.isArray(t[0])?t[0]:e.makeArray(t)};return e.each({push:"length",unshift:0},function(e,n){var i=[][n];s.prototype[n]=function(){for(var n,a,s=[],o=e?this.length:0,u=arguments.length;u--;)a=arguments[u],s[u]=r.set(this,u,this.__type(a,u));return n=i.apply(this,s),(!this.comparator||s.length)&&this._triggerChange(""+o,"add",s,t),n}}),e.each({pop:"length",shift:0},function(e,n){s.prototype[n]=function(){var i=o(arguments),a=e&&this.length?this.length-1:0,s=[][n].apply(this,i);return this._triggerChange(""+a,"remove",t,[s]),s&&s.unbind&&r.remove(this,s),s}}),e.extend(s.prototype,{indexOf:function(t,n){return this.attr("length"),e.inArray(t,this,n)},join:function(){return[].join.apply(this.attr(),arguments)},reverse:function(){var t=e.makeArray([].reverse.call(this));this.replace(t)},slice:function(){var t=Array.prototype.slice.apply(this,arguments);return new this.constructor(t)},concat:function(){var t=[];return e.each(e.makeArray(arguments),function(n,r){t[r]=n instanceof e.List?n.serialize():n}),new this.constructor(Array.prototype.concat.apply(this.serialize(),t))},forEach:function(t,n){return e.each(this,t,n||this)},replace:function(t){return e.isDeferred(t)?t.then(e.proxy(this.replace,this)):this.splice.apply(this,[0,this.length].concat(e.makeArray(t||[]))),this},filter:function(t,n){var r,i=new e.List,a=this;return this.each(function(e,s){r=t.call(n|a,e,s,a),r&&i.push(e)}),i}}),e.List=n.List=s,e.List}(s,d,l);(function(e){var n=[];e.__read=function(t,e){n.push({});var r=t.call(e);return{value:r,observed:n.pop()}},e.__reading=function(t,e){n.length&&(n[n.length-1][t._cid+"|"+e]={obj:t,event:e+""})},e.__clearReading=function(){if(n.length){var t=n[n.length-1];return n[n.length-1]={},t}},e.__setReading=function(t){n.length&&(n[n.length-1]=t)},e.__addReading=function(t){n.length&&e.simpleExtend(n[n.length-1],t)};var r=function(t,n,r,a){var o=e.__read(t,n),u=o.observed;return i(r,u,a),s(r,a),o},i=function(t,e,n){for(var r in e)a(t,e,r,n)},a=function(t,e,n,r){if(t[n])delete t[n];else{var i=e[n];i.obj.bind(i.event,r)}},s=function(t,e){for(var n in t){var r=t[n];r.obj.unbind(r.event,e)}},o=function(t,n,r,i){n!==r&&e.batch.trigger(t,i?{type:"change",batchNum:i}:"change",[n,r])},u=function(n,i,a,s){var o,u,c;return{on:function(l){u||(u=function(e){if(n.bound&&(e.batchNum===t||e.batchNum!==c)){var s=o.value;o=r(i,a,o.observed,u),l(o.value,s,e.batchNum),c=c=e.batchNum}}),o=r(i,a,{},u),s(o.value),n.hasDependencies=!e.isEmptyObject(o.observed)},off:function(){for(var t in o.observed){var e=o.observed[t];e.obj.unbind(e.event,u)}}}},c=function(n,i,a,s){var o,u,c,l;return{on:function(h){c||(c=function(e){if(n.bound&&(e.batchNum===t||e.batchNum!==l)){var r=i.call(a);h(r,u,e.batchNum),u=r,l=l=e.batchNum}}),o=r(i,a,{},c),u=o.value,s(o.value),n.hasDependencies=!e.isEmptyObject(o.observed)},off:function(){for(var t in o.observed){var e=o.observed[t];e.obj.unbind(e.event,c)}}}},l=function(t){return t instanceof e.Map||t&&t.__get},h=function(){};e.compute=function(r,i,a,s){if(r&&r.isComputed)return r;for(var l,d,p,f=h,g=h,m=function(){return d},v=function(t){d=t},_=v,b=[],y=function(t,e,n){_(t),o(l,t,e,n)},w=0,x=arguments.length;x>w;w++)b[w]=arguments[w];if(l=function(r){if(arguments.length){var a=d,s=v.call(i,r,a);return l.hasDependencies?m.call(i):(d=s===t?m.call(i):s,o(l,d,a),d)}return n.length&&l.canReadForChangeEvent!==!1&&(e.__reading(l,"change"),l.bound||e.compute.temporarilyBind(l)),l.bound?d:m.call(i)},"function"==typeof r){v=r,m=r,l.canReadForChangeEvent=a===!1?!1:!0;var k=s?c(l,r,i||this,_):u(l,r,i||this,_);f=k.on,g=k.off}else if(i)if("string"==typeof i){var A=i,C=r instanceof e.Map;if(C){l.hasDependencies=!0;var M;m=function(){return r.attr(A)},v=function(t){r.attr(A,t)},f=function(t){M=function(e,n,r){t(n,r,e.batchNum)},r.bind(a||A,M),d=e.__read(m).value},g=function(){r.unbind(a||A,M)}}else m=function(){return r[A]},v=function(t){r[A]=t},f=function(t){M=function(){t(m(),d)},e.bind.call(r,a||A,M),d=e.__read(m).value},g=function(){e.unbind.call(r,a||A,M)}}else if("function"==typeof i)d=r,v=i,i=a,p="setter";else{d=r;var N=i,O=y;if(i=N.context||N,m=N.get||m,v=N.set||function(){return d},N.fn){var T,L=N.fn;m=function(){return L.call(i,d)},0===L.length?T=u(l,L,i,_):1===L.length?T=u(l,function(){return L.call(i,d)},i,_):(y=function(e){e!==t&&O(e,d)},T=u(l,function(){var e=L.call(i,d,function(t){O(t,d)});return e!==t?e:d},i,_)),f=T.on,g=T.off}else y=function(){var t=m.call(i);O(t,d)};f=N.on||f,g=N.off||g}else d=r;return e.cid(l,"compute"),e.simpleExtend(l,{isComputed:!0,_bindsetup:function(){this.bound=!0;var t=e.__clearReading();f.call(this,y),e.__setReading(t)},_bindteardown:function(){g.call(this,y),this.bound=!1},bind:e.bindAndSetup,unbind:e.unbindAndTeardown,clone:function(t){return t&&("setter"===p?b[2]=t:b[1]=t),e.compute.apply(e,b)}})};var d,p=function(){for(var t=0,e=d.length;e>t;t++)d[t].unbind("change",h);d=null};return e.compute.temporarilyBind=function(t){t.bind("change",h),d||(d=[],setTimeout(p,10)),d.push(t)},e.compute.truthy=function(t){return e.compute(function(){var e=t();return"function"==typeof e&&(e=e()),!!e})},e.compute.async=function(t,n,r){return e.compute(t,{fn:n,context:r})},e.compute.read=function(n,r,i){i=i||{};for(var a,s,o,u=n,c=0,h=r.length;h>c;c++)if(s=u,s&&s.isComputed&&(i.foundObservable&&i.foundObservable(s,c),s=s()),l(s)?(!o&&i.foundObservable&&i.foundObservable(s,c),o=1,u="function"==typeof s[r[c]]&&s.constructor.prototype[r[c]]===s[r[c]]?i.returnObserveMethods?u[r[c]]:"constructor"===r[c]&&s instanceof e.Construct?s[r[c]]:s[r[c]].apply(s,i.args||[]):u.attr(r[c])):u=s[r[c]],a=typeof u,u&&u.isComputed&&!i.isArgument&&h-1>c?(!o&&i.foundObservable&&i.foundObservable(s,c+1),u=u()):r.length-1>c&&"function"===a&&i.executeAnonymousFunctions&&!(e.Construct&&u.prototype instanceof e.Construct)&&(u=u()),r.length-1>c&&(null===u||"function"!==a&&"object"!==a))return i.earlyExit&&i.earlyExit(s,c,u),{value:t,parent:s};return"function"!=typeof u||e.Construct&&u.prototype instanceof e.Construct||(i.isArgument?u.isComputed||i.proxyMethods===!1||(u=e.proxy(u,s)):(u.isComputed&&!o&&i.foundObservable&&i.foundObservable(u,c),u=u.call(s))),u===t&&i.earlyExit&&i.earlyExit(s,c-1),{value:u,parent:s}},e.compute})(s,c,h),function(e){var n=function(t,n,r){var i=new e.Deferred;return t.then(function(){var t=e.makeArray(arguments),a=!0;try{t[0]=r.apply(n,t)}catch(s){a=!1,i.rejectWith(i,[s].concat(t))}a&&i.resolveWith(i,t)},function(){i.rejectWith(this,arguments)}),"function"==typeof t.abort&&(i.abort=function(){return t.abort()}),i},r=0,i=function(t){return e.__reading(t,t.constructor.id),t.__get(t.constructor.id)},a=function(t,n,r,i,a,s){var o={};if("string"==typeof t){var u=t.split(/\s+/);o.url=u.pop(),u.length&&(o.type=u.pop())}else e.extend(o,t);return o.data="object"!=typeof n||e.isArray(n)?n:e.extend(o.data||{},n),o.url=e.sub(o.url,o.data,!0),e.ajax(e.extend({type:r||"post",dataType:i||"json",success:a,error:s},o))},s=function(t,r,a,s,o){var u;e.isArray(t)?(u=t[1],t=t[0]):u=t.serialize(),u=[u];var c,l,h=t.constructor;return("update"===r||"destroy"===r)&&u.unshift(i(t)),l=h[r].apply(h,u),c=n(l,t,function(e){return t[o||r+"d"](e,l),t}),l.abort&&(c.abort=function(){l.abort()}),c.then(a,s),c},o={models:function(n){return function(r,i){if(e.Model._reqs++,r){if(r instanceof this.List)return r;var a=this,s=[],o=a.List||m,u=i instanceof e.List?i:new o,c=e.isArray(r),l=r instanceof m,h=c?r:l?r.serialize():e.getObject(n||"data",r);if(h===t)throw Error("Could not get any raw data while converting using .models");return u.length&&u.splice(0),e.each(h,function(t){s.push(a.model(t))}),u.push.apply(u,s),c||e.each(r,function(t,e){"data"!==e&&u.attr(e,t)}),setTimeout(e.proxy(this._clean,this),1),u}}},model:function(t){return function(n){if(n){"function"==typeof n.serialize&&(n=n.serialize()),this.parseModel?n=this.parseModel.apply(this,arguments):t&&(n=e.getObject(t||"data",n));var r=n[this.id],i=(r||0===r)&&this.store[r]?this.store[r].attr(n,this.removeAttr||!1):new this(n);return i}}}},u=function(t){return function(n){return t?e.getObject(t||"data",n):n}},c={parseModel:u,parseModels:u},l={create:{url:"_shortName",type:"post"},update:{data:function(t,n){n=n||{};var r=this.id;return n[r]&&n[r]!==t&&(n["new"+e.capitalize(t)]=n[r],delete n[r]),n[r]=t,n},type:"put"},destroy:{type:"delete",data:function(t,e){return e=e||{},e.id=e[this.id]=t,e}},findAll:{url:"_shortName"},findOne:{}},h=function(t,e){return function(n){return n=t.data?t.data.apply(this,arguments):n,a(e||this[t.url||"_url"],n,t.type||"get")}},d=function(t,e){if(t.resource){var n=t.resource.replace(/\/+$/,"");return"findAll"===e||"create"===e?n:n+"/{"+t.id+"}"}};e.Model=e.Map.extend({fullName:"can.Model",_reqs:0,setup:function(t,n,i,a){if("string"!==n&&(a=i,i=n),a||(a=i),this.store={},e.Map.setup.apply(this,arguments),e.Model){i&&i.List?(this.List=i.List,this.List.Map=this):this.List=t.List.extend({Map:this},{});var s=this,u=e.proxy(this._clean,s);e.each(l,function(n,r){if(e.isFunction(s[r])||(s[r]=h(n,s[r]?s[r]:d(s,r))),s["make"+e.capitalize(r)]){var i=s["make"+e.capitalize(r)](s[r]);e.Construct._overwrite(s,t,r,function(){e.Model._reqs++;var t=i.apply(this,arguments),n=t.then(u,u);return n.abort=t.abort,n})}}),e.each(o,function(n,r){var i="parse"+e.capitalize(r),o=s[r];"string"==typeof o?(e.Construct._overwrite(s,t,i,c[i](o)),e.Construct._overwrite(s,t,r,n(o))):a&&(a[r]||a[i])||e.Construct._overwrite(s,t,i,c[i]())}),e.each(c,function(n,r){"string"==typeof s[r]&&e.Construct._overwrite(s,t,r,n(s[r]))
}),"can.Model"!==s.fullName&&s.fullName||(s.fullName="Model"+ ++r),e.Model._reqs=0,this._url=this._shortName+"/{"+this.id+"}"}},_ajax:h,_makeRequest:s,_clean:function(){if(e.Model._reqs--,!e.Model._reqs)for(var t in this.store)this.store[t]._bindings||delete this.store[t];return arguments[0]},models:o.models("data"),model:o.model()},{setup:function(t){var n=t&&t[this.constructor.id];e.Model._reqs&&null!=n&&(this.constructor.store[n]=this),e.Map.prototype.setup.apply(this,arguments)},isNew:function(){var t=i(this);return!(t||0===t)},save:function(t,e){return s(this,this.isNew()?"create":"update",t,e)},destroy:function(t,n){if(this.isNew()){var r=this,i=e.Deferred();return i.then(t,n),i.done(function(t){r.destroyed(t)}).resolve(r)}return s(this,"destroy",t,n,"destroyed")},_bindsetup:function(){return this.constructor.store[this.__get(this.constructor.id)]=this,e.Map.prototype._bindsetup.apply(this,arguments)},_bindteardown:function(){return delete this.constructor.store[i(this)],e.Map.prototype._bindteardown.apply(this,arguments)},___set:function(t,n){e.Map.prototype.___set.call(this,t,n),t===this.constructor.id&&this._bindings&&(this.constructor.store[i(this)]=this)}});var p=function(t){var n="parse"+e.capitalize(t);return function(e){return this[n]&&(e=this[n].apply(this,arguments)),this[t](e)}},f=function(t){return this.parseModel?this.parseModel.apply(this,arguments):this.model(t)},g={makeFindAll:p("models"),makeFindOne:p("model"),makeCreate:f,makeUpdate:f};e.each(g,function(t,r){e.Model[r]=function(r){return function(){var i=e.makeArray(arguments),a=e.isFunction(i[1])?i.splice(0,1):i.splice(0,2),s=n(r.apply(this,a),this,t);return s.then(i[0],i[1]),s}}}),e.each(["created","updated","destroyed"],function(t){e.Model.prototype[t]=function(n){var r,i=this.constructor;r=n&&"object"==typeof n&&this.attr(n.attr?n.attr():n),e.dispatch.call(this,{type:"change",target:this},[t]),e.dispatch.call(i,t,[this])}});var m=e.Model.List=e.List.extend({_bubbleRule:function(t,n){return e.List._bubbleRule(t,n)||"destroyed"}},{setup:function(t){e.isPlainObject(t)&&!e.isArray(t)?(e.List.prototype.setup.apply(this),this.replace(this.constructor.Map.findAll(t))):e.List.prototype.setup.apply(this,arguments),this._init=1,this.bind("destroyed",e.proxy(this._destroyed,this)),delete this._init},_destroyed:function(t,e){if(/\w+/.test(e))for(var n;(n=this.indexOf(t.target))>-1;)this.splice(n,1)}});return e.Model}(s,d,p),window.can=e})();